<div class="container">
  <div class="page-header">
    <h1>ğŸ¢ Processar SICAF</h1>
    <p>Extrair e processar dados de SICAF em formato PDF</p>
  </div>

  <!-- SeÃ§Ã£o de SeleÃ§Ã£o de Arquivo JSON -->
  <div class="section">
    <h2>ğŸ“‹ Selecionar LicitaÃ§Ã£o</h2>
    
    <div *ngIf="jsonFiles.length === 0" class="empty-state">
      <p>ğŸ“‚ Nenhum arquivo JSON de licitaÃ§Ã£o encontrado</p>
      <p>Adicione seus arquivos JSON processados na pasta Database/Resultados</p>
    </div>
    
    <div class="form-group">
      <label for="jsonSelect">Selecione o arquivo JSON da licitaÃ§Ã£o:</label>
      <select id="jsonSelect" [(ngModel)]="selectedJsonFile" (change)="onJsonFileSelected()" class="form-control">
        <option value="">{{ jsonFiles.length === 0 ? 'Nenhum arquivo encontrado' : 'Selecione um arquivo...' }}</option>
        <option *ngFor="let file of jsonFiles" [value]="file.file_path">
          {{ file.file_name }} ({{ file.propostas_count || 0 }} propostas)
        </option>
      </select>
    </div>
    
    <div class="actions">
      <button type="button" (click)="openResultsFolder()" class="btn btn-primary">
        ğŸ“ Abrir Pasta de Resultados
      </button>
      <button type="button" (click)="loadJsonFiles()" class="btn btn-secondary">
        ğŸ”„ Atualizar Lista
      </button>
    </div>
  </div>

  <!-- SeÃ§Ã£o de Empresas/CNPJs -->
  <div class="section" *ngIf="sicafData.length > 0">
    <h2>ğŸ¢ Empresas da LicitaÃ§Ã£o</h2>
    <div class="info-cards">
      <div class="info-card">
        <h3>Total de CNPJs</h3>
        <p class="number">{{ sicafData.length }}</p>
      </div>
      <div class="info-card">
        <h3>SICAF Verificados</h3>
        <p class="number success">{{ verifiedCount }}</p>
      </div>
      <div class="info-card">
        <h3>NÃ£o Verificados</h3>
        <p class="number warning">{{ notVerifiedCount }}</p>
      </div>
    </div>

    <div class="empresa-list">
      <div class="empresa-item" *ngFor="let empresa of sicafData" [class.verified]="empresa.situacao_cadastro === 'Verificado'">
        <div class="empresa-info">
          <div class="empresa-header">
            <span class="status-icon" [class.verified]="empresa.situacao_cadastro === 'Verificado'">
              {{ empresa.situacao_cadastro === 'Verificado' ? 'âœ…' : 'âŒ' }}
            </span>
            <h4>{{ empresa.empresa }}</h4>
            <button type="button" (click)="copyToClipboard(empresa.cnpj)" class="btn btn-copy" title="Copiar CNPJ">
              ğŸ“‹
            </button>
          </div>
          <div class="empresa-details">
            <p><strong>CNPJ:</strong> {{ empresa.cnpj }}</p>
            <p *ngIf="empresa.nome_fantasia"><strong>Nome Fantasia:</strong> {{ empresa.nome_fantasia }}</p>
            <p *ngIf="empresa.endereco"><strong>EndereÃ§o:</strong> {{ empresa.endereco }}</p>
            <p *ngIf="empresa.municipio && empresa.uf"><strong>LocalizaÃ§Ã£o:</strong> {{ empresa.municipio }}/{{ empresa.uf }}</p>
            <p *ngIf="empresa.telefone"><strong>Telefone:</strong> {{ empresa.telefone }}</p>
            <p *ngIf="empresa.email"><strong>Email:</strong> {{ empresa.email }}</p>
            <p *ngIf="empresa.data_vencimento"><strong>Data Vencimento:</strong> {{ empresa.data_vencimento }}</p>
            <p *ngIf="empresa.nome_responsavel"><strong>ResponsÃ¡vel:</strong> {{ empresa.nome_responsavel }}</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- SeÃ§Ã£o de Processamento -->
  <div class="section">
    <h2>ğŸ“ Pasta de PDFs SICAF</h2>
    <div class="pdf-info">
      <div class="info-card">
        <h3>Arquivos PDF</h3>
        <p class="number">{{ pdfCount }}</p>
      </div>
      <div class="info-card" *ngIf="processedCount > 0">
        <h3>Processados</h3>
        <p class="number success">{{ processedCount }}</p>
      </div>
    </div>

    <div class="actions">
      <button type="button" (click)="openSicafFolder()" class="btn btn-primary">
        ğŸ“‚ Abrir Pasta SICAF
      </button>
      <button type="button" (click)="refreshAll()" class="btn btn-secondary">
        ğŸ”„ Atualizar
      </button>
      <button 
        type="button" 
        (click)="processSicafPdfs()" 
        [disabled]="isProcessing || pdfCount === 0"
        class="btn btn-success">
        {{ isProcessing ? 'â³ Processando...' : 'âš¡ Processar PDFs' }}
      </button>
    </div>

    <div class="progress-bar" *ngIf="isProcessing">
      <div class="progress-fill"></div>
    </div>
  </div>

  <!-- SeÃ§Ã£o de Logs -->
  <div class="section">
    <h2>ğŸ“‹ Logs do Sistema</h2>
    <div class="log-controls">
      <button type="button" (click)="clearLogs()" class="btn btn-secondary">
        ğŸ—‘ï¸ Limpar Logs
      </button>
    </div>
    <div class="log-container">
      <div class="log-item" *ngFor="let log of logs">
        {{ log }}
      </div>
      <div *ngIf="logs.length === 0" class="log-item empty">
        Nenhum log disponÃ­vel
      </div>
    </div>
  </div>

  <!-- InstruÃ§Ãµes -->
  <div class="instructions">
    <h4>ğŸ“‹ Como usar:</h4>
    <ol>
      <li><strong>Adicionar LicitaÃ§Ãµes:</strong> Clique em "ğŸ“ Abrir Pasta de Resultados" e coloque seus arquivos JSON de licitaÃ§Ãµes processadas na pasta Database/Resultados</li>
      <li><strong>Selecionar LicitaÃ§Ã£o:</strong> Escolha um arquivo JSON para ver as empresas participantes</li>
      <li><strong>Adicionar SICAF:</strong> Clique em "ğŸ“‚ Abrir Pasta SICAF" e adicione os PDFs do SICAF na pasta Database/SICAF</li>
      <li><strong>Processar:</strong> Clique em "âš¡ Processar PDFs" para extrair os dados dos PDFs SICAF</li>
      <li><strong>Verificar:</strong> Acompanhe o status atravÃ©s dos indicadores âœ…/âŒ e logs do sistema</li>
      <li><strong>Copiar CNPJs:</strong> Use o botÃ£o ğŸ“‹ para copiar CNPJs e facilitar a busca no SICAF</li>
    </ol>
    
    <div class="tips">
      <h5>ğŸ’¡ Dicas importantes:</h5>
      <ul>
        <li>Consulte apenas o 'NÃ­vel 1 - Credenciamento' do SICAF</li>
        <li>A pasta Database Ã© mantida durante atualizaÃ§Ãµes do programa</li>
        <li>Organize os arquivos PDF do SICAF com nomes que incluam o CNPJ</li>
        <li>Use "ğŸ”„ Atualizar" apÃ³s adicionar novos arquivos</li>
      </ul>
    </div>
  </div>
</div>
